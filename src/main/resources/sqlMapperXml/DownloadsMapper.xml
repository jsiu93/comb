<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xzh.comb.mapper.DownloadsMapper" >
  <resultMap id="BaseResultMap" type="com.xzh.comb.model.Downloads" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="session" property="session" jdbcType="CHAR" />
    <result column="timestamp" property="timestamp" jdbcType="TIMESTAMP" />
    <result column="shasum" property="shasum" jdbcType="VARCHAR" />
    <result column="ip" property="ip" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.xzh.comb.model.Downloads" extends="BaseResultMap" >
    <result column="url" property="url" jdbcType="LONGVARCHAR" />
    <result column="outfile" property="outfile" jdbcType="LONGVARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, session, timestamp, shasum
  </sql>
  <sql id="Blob_Column_List" >
    url, outfile
  </sql>
  
  <select id="list" parameterType="Map" resultMap="ResultMapWithBLOBs">
  	SELECT downloads.id, 
	downloads.`session`, 
	downloads.`timestamp`, 
	downloads.url, 
	downloads.`outfile`, 
	downloads.shasum, 
	sessions.ip
	FROM downloads LEFT OUTER JOIN sessions ON downloads.`session` = sessions.id
	<if test="start != null and size != null">
		limit #{start}, #{size}
	</if>
  </select>
  
  <select id="getTotal" parameterType="Map" resultType="Long">
  	SELECT count(*)
	FROM downloads LEFT OUTER JOIN sessions ON downloads.`session` = sessions.id
  </select>
  
</mapper>